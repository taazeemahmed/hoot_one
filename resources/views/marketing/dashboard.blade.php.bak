<x-app-layout>
    <!-- ApexCharts CDN -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- Font for numbers if needed, inter is default usually -->
    <style>
        .font-display { font-family: 'Figtree', sans-serif; }
    </style>

    <div class="min-h-screen bg-[#F8F9FD] p-6 lg:p-10 font-sans text-slate-800">
        
        <!-- Header Section -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-10">
            <div>
                <h1 class="text-4xl font-bold text-[#1B4332] tracking-tight mb-2">Dashboard</h1>
                <p class="text-slate-500 font-medium">Plan, track, and manage your marketing leads with ease.</p>
            </div>
            <div class="mt-4 md:mt-0 flex gap-3">
                <button onclick="window.location='{{ route('marketing.leads.create') }}'" class="bg-[#1B4332] hover:bg-[#143226] text-white px-6 py-2.5 rounded-full font-semibold shadow-lg shadow-[#1B4332]/20 transition-all flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    Add Lead
                </button>
                <button class="bg-white hover:bg-gray-50 text-slate-700 border border-slate-200 px-6 py-2.5 rounded-full font-semibold shadow-sm transition-all">
                    Import Data
                </button>
            </div>
        </div>

        <!-- KPI Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Card 1: Total Pending (The Green Card) -->
            <div class="relative bg-[#1B4332] text-white p-6 rounded-[2rem] shadow-xl shadow-[#1B4332]/20 overflow-hidden group">
                <div class="absolute top-0 right-0 p-6 opacity-20">
                    <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 20 20"><path d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0 1 1 0 002 0zM15 4a1 1 0 10-2 0 1 1 0 002 0zM15 12a1 1 0 10-2 0 1 1 0 002 0z"/></svg>
                </div>
                <div class="relative z-10 flex flex-col h-full justify-between">
                    <div>
                        <h3 class="text-white/80 font-medium text-lg mb-1">Total Pending Leads</h3>
                        <span class="text-5xl font-bold block mt-2">{{ $stats['new_leads'] }}</span>
                    </div>
                    <div class="mt-6 flex items-center gap-2 text-white/90 bg-white/10 w-fit px-3 py-1 rounded-full text-xs font-semibold backdrop-blur-sm">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        <span>Waiting action</span>
                    </div>
                </div>
            </div>

            <!-- Card 2: Assigned Today -->
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100/50 hover:shadow-md transition-shadow flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <h3 class="text-slate-500 font-semibold text-lg">Assigned Today</h3>
                    <div class="p-2 bg-slate-50 rounded-full text-slate-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </div>
                </div>
                <div>
                    <span class="text-4xl font-bold text-slate-800 block my-2">{{ $stats['assigned_today'] }}</span>
                    <div class="flex items-center gap-2 text-emerald-600 text-sm font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        <span>Daily Pace</span>
                    </div>
                </div>
            </div>

            <!-- Card 3: Hot Leads -->
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100/50 hover:shadow-md transition-shadow flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <h3 class="text-slate-500 font-semibold text-lg">Hot & Unassigned</h3>
                     <div class="p-2 bg-slate-50 rounded-full text-slate-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path></svg>
                    </div>
                </div>
                <div>
                    <span class="text-4xl font-bold text-slate-800 block my-2">{{ $stats['hot_leads_unassigned'] }}</span>
                    <div class="flex items-center gap-2 text-rose-500 text-sm font-medium">
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
                        <span>Action Required</span>
                    </div>
                </div>
            </div>

            <!-- Card 4: Monthly Target -->
             <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100/50 hover:shadow-md transition-shadow flex flex-col justify-between">
                <div class="flex justify-between items-start">
                    <h3 class="text-slate-500 font-semibold text-lg">Monthly Goal</h3>
                     <div class="p-2 bg-slate-50 rounded-full text-slate-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                    </div>
                </div>
                <div>
                   <div class="flex items-end gap-2 my-2">
                        <span class="text-4xl font-bold text-slate-800">{{ $score['leads_assigned'] }}</span>
                        <span class="text-lg font-medium text-slate-400 mb-1">/ {{ $score['target_assigned'] }}</span>
                   </div>
                    <div class="w-full bg-slate-100 h-2 rounded-full overflow-hidden mt-2">
                        <div class="bg-[#1B4332] h-full rounded-full" style="width:{{ $score['percentage'] > 100 ? 100 : $score['percentage'] }}%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Section: Analytics & Activity -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            
            <!-- Left: Lead Velocity Chart -->
            <div class="lg:col-span-2 bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100/50">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h3 class="font-bold text-xl text-slate-800">Lead Analytics</h3>
                        <p class="text-slate-400 text-sm mt-1">Assignment velocity over last 7 days</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="w-3 h-3 rounded-full bg-[#1B4332]"></span> <span class="text-xs text-slate-500">Assigned</span>
                    </div>
                </div>
                <div id="velocityChart" class="w-full h-72"></div>
            </div>

            <!-- Right: Upcoming Tasks / Quick Actions -->
            <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100/50 flex flex-col justify-between">
                <div>
                    <h3 class="font-bold text-xl text-slate-800 mb-1">Reminders</h3>
                    <p class="text-slate-400 text-sm mb-6">Check your daily tasks</p>
                    
                    <div class="bg-[#EFF2F1] p-5 rounded-2xl mb-4 group hover:bg-[#1B4332] transition-colors cursor-pointer">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-slate-800 group-hover:text-white">Call Hot Leads</h4>
                                <p class="text-xs text-slate-500 mt-1 group-hover:text-white/70">{{ $stats['hot_leads_unassigned'] }} pending calls for today</p>
                            </div>
                            <div class="bg-white p-2 rounded-full text-[#1B4332]">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                            </div>
                        </div>
                    </div>

                     <div class="bg-white border-2 border-dashed border-slate-200 p-5 rounded-2xl flex items-center justify-center text-slate-400 hover:border-[#1B4332] hover:text-[#1B4332] cursor-pointer transition-colors">
                        <span class="font-semibold text-sm">+ Add Task</span>
                    </div>
                </div>
                
                 <button class="w-full bg-[#1B4332] text-white py-4 rounded-2xl font-bold shadow-lg shadow-[#1B4332]/20 mt-4 hover:translate-y-[-2px] transition-transform flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Start Calling
                </button>
            </div>
        </div>

        <!-- Bottom Section: Lists & Quality -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Incoming Leads List -->
            <div class="lg:col-span-2 bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100/50">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-xl text-slate-800">Fresh Incoming</h3>
                    <a href="{{ route('marketing.leads.index', ['status' => 'new']) }}" class="text-sm font-semibold text-slate-400 hover:text-[#1B4332]">View All</a>
                </div>
                
                <div class="space-y-4">
                    @forelse($incomingLeads as $lead)
                    <div class="flex items-center justify-between p-4 bg-[#F8F9FD] rounded-2xl hover:bg-white hover:shadow-md transition-all border border-transparent hover:border-slate-100">
                        <div class="flex items-center gap-4">
                             <div class="w-12 h-12 rounded-full bg-white border border-slate-200 flex items-center justify-center text-lg font-bold text-[#1B4332]">
                                {{ substr($lead->name, 0, 1) }}
                            </div>
                            <div>
                                <h4 class="font-bold text-slate-800">{{ $lead->name }}</h4>
                                <div class="flex gap-2 text-xs text-slate-500 mt-0.5">
                                    <span>{{ $lead->created_at->diffForHumans() }}</span>
                                    <span>â€¢</span>
                                    <span>{{ ucfirst($lead->source) }}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                             @if($lead->lead_quality === 'hot')
                                <span class="px-3 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700">Hot Lead</span>
                            @elseif($lead->lead_quality === 'warm')
                                <span class="px-3 py-1 rounded-full text-xs font-bold bg-yellow-100 text-yellow-700">Warm</span>
                            @else
                                <span class="px-3 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700">Cold</span>
                            @endif
                            
                            <a href="{{ route('marketing.leads.edit', $lead) }}" class="p-2 bg-white rounded-full text-slate-400 hover:text-[#1B4332] hover:bg-green-50 transition-colors border border-slate-200">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            </a>
                        </div>
                    </div>
                    @empty
                    <div class="text-center py-8 text-slate-400 text-sm">No new leads pending.</div>
                    @endforelse
                </div>
            </div>

            <!-- Quality Donut -->
             <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100/50 flex flex-col items-center">
                 <h3 class="font-bold text-xl text-slate-800 mb-6 w-full text-left">Quality Distribution</h3>
                 <div id="qualityChart" class="w-full h-64"></div>
            </div>

        </div>

    </div>

     <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Velocity Chart - Real Data
            var velocityOptions = {
                series: [{
                    name: "Assigned",
                    data: [@foreach($velocityData as $v){{ $v['count'] }}@if(!$loop->last),@endif @endforeach]
                }],
                chart: {
                    height: 280,
                    type: 'bar',
                    toolbar: { show: false },
                    fontFamily: 'Figtree, sans-serif',
                },
                colors: ['#1B4332'],
                plotOptions: {
                    bar: {
                        borderRadius: 8,
                        columnWidth: '40%',
                    }
                },
                dataLabels: { enabled: false },
                xaxis: {
                    categories: [@foreach($velocityData as $v)'{{ $v['day'] }}'@if(!$loop->last),@endif @endforeach],
                    labels: { style: { colors: '#94A3B8', fontSize: '12px' } },
                    axisBorder: { show: false },
                    axisTicks: { show: false }
                },
                yaxis: { show: false },
                grid: {
                    show: false,
                },
                fill: {
                    opacity: 1
                },
            };
            var velocityChart = new ApexCharts(document.querySelector("#velocityChart"), velocityOptions);
            velocityChart.render();

            // Quality Chart - Real Data
            var qualityOptions = {
                series: [{{ $qualityData['hot'] }}, {{ $qualityData['warm'] }}, {{ $qualityData['cold'] }}],
                chart: {
                    type: 'donut',
                    height: 280,
                    fontFamily: 'Figtree, sans-serif',
                },
                labels: ['Hot', 'Warm', 'Cold'],
                colors: ['#DC2626', '#F59E0B', '#3B82F6'],
                plotOptions: {
                    pie: {
                        donut: {
                            size: '75%',
                            labels: {
                                show: true,
                                name: { show: false },
                                value: {
                                    color: '#1B4332',
                                    fontSize: '32px',
                                    fontWeight: 800,
                                    offsetY: 8,
                                    formatter: function (val) { return val }
                                },
                                total: {
                                    show: true,
                                    showAlways: true,
                                    label: 'Total Leads',
                                    fontSize: '12px',
                                    color: '#64748B',
                                    formatter: function (w) {
                                        return w.globals.seriesTotals.reduce((a, b) => { return a + b }, 0)
                                    }
                                }
                            }
                        }
                    }
                },
                dataLabels: { enabled: false },
                stroke: { show: false },
                legend: { position: 'bottom', horizontalAlign: 'center' }
            };
            var qualityChart = new ApexCharts(document.querySelector("#qualityChart"), qualityOptions);
            qualityChart.render();
        });
    </script>
</x-app-layout>
